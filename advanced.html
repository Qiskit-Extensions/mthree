<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="M3 paper example" href="tutorials/01_M3_ex1.html" /><link rel="prev" title="Balanced calibrations" href="balanced.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.01.29 -->
        <title>Advanced usage - Mthree 2.7.0</title>
      <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/qiskit-sphinx-theme.css?v=fe84956c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/qiskit-ecosystem.css?v=745c5aa7" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
<script src="_static/js/web-components/top-nav-bar.js"></script></head>
  <body>
    
    <script>document.body.dataset.theme = "light";</script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
      <defs><style>.cls-1{fill:none;}</style></defs>
      <path d="M28,4H4A2,2,0,0,0,2,6V26a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V6A2,2,0,0,0,28,4ZM4,6H20V26H4ZM28,26H22V6h6Z"/>
      <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
      <defs><style>.cls-1{fill:none;}</style></defs>
      <rect x="4" y="6" width="24" height="2"/>
      <rect x="4" y="24" width="24" height="2"/>
      <rect x="4" y="12" width="24" height="2"/>
      <rect x="4" y="18" width="24" height="2"/>
      <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg version="1.1" id="icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
         viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve"><polygon points="22,16 12,26 10.6,24.6 19.2,16 10.6,7.4 12,6 " stroke="currentColor"/>
      <rect id="_x3C_Transparent_Rectangle_x3E_" fill="none" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-new-tab" viewBox="0 0 32 32">
    <svg id="icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
      <defs>
        <style>
          .cls-1 {
            fill: none;
          }
        </style>
      </defs>
      <path fill="#6929C4" d="M26,28H6a2.0027,2.0027,0,0,1-2-2V6A2.0027,2.0027,0,0,1,6,4H16V6H6V26H26V16h2V26A2.0027,2.0027,0,0,1,26,28Z"/>
      <polygon fill="#6929C4" points="20 2 20 4 26.586 4 18 12.586 19.414 14 28 5.414 28 12 30 12 30 2 20 2"/>
      <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Mthree 2.7.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-brand">
  <a href="https://www.qiskit.org/ecosystem">
    <div class="sidebar-logo-container">
      <img class="sidebar-logo" src="_static/images/ecosystem-logo.svg" alt="Qiskit Ecosystem logo"/>
    </div>
  </a>
  
  <span class="sidebar-brand-text">Mthree 2.7.0</span>
</div><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">mthree (2.7.0)</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basic.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">Using Runtime modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="transpiled.html">Transpiled circuits</a></li>
<li class="toctree-l1"><a class="reference internal" href="expvals.html">Expectation values</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampling.html">Sampling problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="collections.html">Using collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="grouped.html">Grouped operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="error.html">Error analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="marginals.html">Low-weight operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="probs.html">Obtaining probabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="cal_io.html">Saving and loading calibrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utility functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="balanced.html">Balanced calibration</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Advanced usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/01_M3_ex1.html">M3 paper example</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/02_correcting_probs.html">Correcting probabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/03_qv_example.html">Quantum Volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/04_dynamic_bv.html">Dynamic Bernstein–Vazirani</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/10_basic_vqe.html">Basic mitigated VQE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="apidocs/main.html">Mitigation class</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Mitigation class</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="stubs/mthree.M3Mitigation.html">mthree.M3Mitigation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="apidocs/classes.html">Distributions</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Distributions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="stubs/mthree.classes.QuasiDistribution.html">mthree.classes.QuasiDistribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="stubs/mthree.classes.ProbDistribution.html">mthree.classes.ProbDistribution</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="apidocs/classes.html#distribution-collections">Distribution collections</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Distribution collections</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="stubs/mthree.classes.QuasiCollection.html">mthree.classes.QuasiCollection</a></li>
<li class="toctree-l2"><a class="reference internal" href="stubs/mthree.classes.ProbCollection.html">mthree.classes.ProbCollection</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="apidocs/utils.html">Utility functions</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Utility functions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="stubs/mthree.utils.final_measurement_mapping.html">mthree.utils.final_measurement_mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="stubs/mthree.utils.expval.html">mthree.utils.expval</a></li>
<li class="toctree-l2"><a class="reference internal" href="stubs/mthree.utils.stddev.html">mthree.utils.stddev</a></li>
<li class="toctree-l2"><a class="reference internal" href="stubs/mthree.utils.expval_and_stddev.html">mthree.utils.expval_and_stddev</a></li>
<li class="toctree-l2"><a class="reference internal" href="stubs/mthree.utils.marginal_distribution.html">mthree.utils.marginal_distribution</a></li>
</ul>
</li>
</ul>

</div></div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="advanced-usage">
<span id="advanced"></span><h1>Advanced usage<a class="headerlink" href="#advanced-usage" title="Link to this heading">¶</a></h1>
<section id="options-for-m3mitigation-class">
<h2>Options for M3Mitigation class<a class="headerlink" href="#options-for-m3mitigation-class" title="Link to this heading">¶</a></h2>
<section id="iter-threshold">
<h3><code class="docutils literal notranslate"><span class="pre">iter_threshold</span></code><a class="headerlink" href="#iter-threshold" title="Link to this heading">¶</a></h3>
<p>The main <a class="reference internal" href="stubs/mthree.M3Mitigation.html#mthree.M3Mitigation" title="mthree.M3Mitigation"><code class="xref py py-class docutils literal notranslate"><span class="pre">mthree.M3Mitigation</span></code></a> class accepts the <cite>iter_threshold</cite> keyword argument
that determines when the automated method selector pickes the iterative method
over direct LU factorization (selection also depends on free memory).</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit_ibm_runtime.fake_provider</span> <span class="kn">import</span> <span class="n">FakeCasablancaV2</span>
<span class="kn">import</span> <span class="nn">mthree</span>

<span class="n">backend</span> <span class="o">=</span> <span class="n">FakeCasablancaV2</span><span class="p">()</span>
<span class="n">mit</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">M3Mitigation</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">iter_threshold</span><span class="o">=</span><span class="mi">4321</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
</section>
<section id="options-for-calibration">
<h2>Options for calibration<a class="headerlink" href="#options-for-calibration" title="Link to this heading">¶</a></h2>
<section id="shots">
<h3><code class="docutils literal notranslate"><span class="pre">shots</span></code><a class="headerlink" href="#shots" title="Link to this heading">¶</a></h3>
<p>When calibrating the mitigator, it is possible to vary the number of shots per calibration circuit:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">M3Mitigation</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
<span class="n">mit</span><span class="o">.</span><span class="n">cals_from_system</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">shots</span><span class="o">=</span><span class="mi">4321</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;qiskit.primitives.primitive_job.PrimitiveJob at 0x7fc8353c2d70&gt;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="method">
<h3><code class="docutils literal notranslate"><span class="pre">method</span></code><a class="headerlink" href="#method" title="Link to this heading">¶</a></h3>
<p>There are three ways to do the calibration.  The default <code class="docutils literal notranslate"><span class="pre">balanced</span></code> method executes <span class="math notranslate nohighlight">\(2N\)</span> circuits
with varying bitstring patterns such that the <span class="math notranslate nohighlight">\(|0\rangle\)</span> and <span class="math notranslate nohighlight">\(|1\rangle\)</span> states are each
prepared <span class="math notranslate nohighlight">\(N\)</span> times and averaged over.  For example, the balanced bit-strings over four qubits are</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mthree</span><span class="o">.</span><span class="n">circuits</span><span class="o">.</span><span class="n">balanced_cal_strings</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;0101&#39;, &#39;1010&#39;, &#39;0011&#39;, &#39;1100&#39;, &#39;0001&#39;, &#39;1110&#39;, &#39;0000&#39;, &#39;1111&#39;]
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">independent</span></code> method also sends <span class="math notranslate nohighlight">\(2N\)</span> circuits but measures only a single qubit at a time.
As such, this is a truely uncorrelated calibration process.</p>
<p>Finally, a <code class="docutils literal notranslate"><span class="pre">marginal</span></code> calibration can also be done that sends only two circuits,
<span class="math notranslate nohighlight">\(|0\rangle^{\otimes N}\)</span> and <span class="math notranslate nohighlight">\(|1\rangle^{\otimes N}\)</span>, and marginalizes over the
results to get the needed <span class="math notranslate nohighlight">\(2N\)</span> error rates.  These two states are a sub-set of the <code class="docutils literal notranslate"><span class="pre">balanced</span></code>
calibrations, and are what Qiskit uses in its readout mitigation.  This method is very sensitive to
state preparation errors, and should not be used in practice.</p>
<p>An example setting the method is</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">M3Mitigation</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
<span class="n">mit</span><span class="o">.</span><span class="n">cals_from_system</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;independent&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;qiskit.primitives.primitive_job.PrimitiveJob at 0x7fc8247bf490&gt;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="rep-delay">
<h3><code class="docutils literal notranslate"><span class="pre">rep_delay</span></code><a class="headerlink" href="#rep-delay" title="Link to this heading">¶</a></h3>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Do not set this unless you know what you are doing.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">rep_delay</span></code> keyword argument sets the time between calibration circuits on IBM Quantum systems.
This option exists to test and reduce the presence of state prep errors.  The calibration circuits
in M3 all contain conditional resets at the beginning so as to minimize the need for setting this
option.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">M3Mitigation</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
<span class="n">mit</span><span class="o">.</span><span class="n">cals_from_system</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">rep_delay</span><span class="o">=</span><span class="mf">400e-6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;qiskit.primitives.primitive_job.PrimitiveJob at 0x7fc823f59450&gt;]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="initial-reset">
<h2><code class="docutils literal notranslate"><span class="pre">initial_reset</span></code><a class="headerlink" href="#initial-reset" title="Link to this heading">¶</a></h2>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Do not set this unless you know what you are doing.</p>
</div>
<p>A boolean value that specifies whether reset instructions should be used at the beginning of the
calibration circuits.  Ideally this helps to supress any residual state prep errors that occur from
imperfect reset of the qubits.  Can be used in concert with, or as an alternative to <code class="docutils literal notranslate"><span class="pre">rep_delay</span></code>.
Note that, in order for this to work, the circuits that need to be mitigated must also have reset
instructions at the beginning.  Otherwise you are calibrating for no state-prep errors, but the
actual circuits may still suffer from these errors.</p>
</section>
<section id="options-when-applying-corrections">
<h2>Options when applying corrections<a class="headerlink" href="#options-when-applying-corrections" title="Link to this heading">¶</a></h2>
<p>Here we first calibrate a mitigator and generate raw counts:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>

<span class="n">mit</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">M3Mitigation</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
<span class="n">mit</span><span class="o">.</span><span class="n">cals_from_system</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>

<span class="n">trans_qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
<span class="n">raw_counts</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">trans_qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">8192</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<section id="id1">
<h3><code class="docutils literal notranslate"><span class="pre">method</span></code><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>There are two ways to solve the linear system of equations generated by M3.  First, the
<code class="docutils literal notranslate"><span class="pre">direct</span></code> method uses LU-factorization by constructing the reduced assignment matrix.
Second the <code class="docutils literal notranslate"><span class="pre">iterative</span></code> method uses preconditioned iterative solvers to find the
solution vector without explicit matrix construction.  By default M3 uses an <code class="docutils literal notranslate"><span class="pre">auto</span></code>
method that selects the appropriate solution method based on the number of unique
bit-strings and the available free memory on the computer.  To override this, one
can simply set the option:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasis</span> <span class="o">=</span> <span class="n">mit</span><span class="o">.</span><span class="n">apply_correction</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;iterative&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="distance">
<h3><code class="docutils literal notranslate"><span class="pre">distance</span></code><a class="headerlink" href="#distance" title="Link to this heading">¶</a></h3>
<p>Optionally one may trucate the M3 assignment matrix to only those elements of the matrix that
are transistions between elements less than or equal to a given Hamming distance away from
each other.  This does not change the dimensionality of the underlying matrix, but rather
changes the sparsity pattern of the elements.  This is done using the <code class="docutils literal notranslate"><span class="pre">distance</span></code> keyword argument.
By default, M3 computes the corrections out to the full distance.  In practice, including only
up to <code class="docutils literal notranslate"><span class="pre">distance=3</span></code> elements yields accurate answers in most cases.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasis</span> <span class="o">=</span> <span class="n">mit</span><span class="o">.</span><span class="n">apply_correction</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">distance</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="details">
<h3><code class="docutils literal notranslate"><span class="pre">details</span></code><a class="headerlink" href="#details" title="Link to this heading">¶</a></h3>
<p>Allows one to see additional information about the solution.  This changes the return of the
:method:<code class="docutils literal notranslate"><span class="pre">mthree.M3Mitigation.apply_correction</span></code> method to a tuple of two values:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasis</span><span class="p">,</span> <span class="n">details</span> <span class="o">=</span> <span class="n">mit</span><span class="o">.</span><span class="n">apply_correction</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;method&#39;: &#39;direct&#39;, &#39;time&#39;: 0.0003483669999582162, &#39;dimension&#39;: 44, &#39;col_norms&#39;: array([0.99922498, 0.97911138, 0.97084977, 0.9715674 , 0.98368322,
       0.97963047, 0.98020229, 0.97012601, 0.92660539, 0.94726961,
       0.96536347, 0.98588829, 0.96992307, 0.95781586, 0.92738993,
       0.97763408, 0.97437522, 0.9488427 , 0.94831464, 0.91635929,
       0.99625462, 0.97788582, 0.95919123, 0.95795712, 0.9586207 ,
       0.96997685, 0.92678153, 0.93001298, 0.93105022, 0.99633706,
       0.98375924, 0.89675293, 0.94732457, 0.93054155, 0.95365176,
       0.99572988, 0.99827843, 0.95846144, 0.9311231 , 0.99560234,
       0.94754313, 0.99633029, 0.99611871, 0.99979961])}
</pre></div>
</div>
</div>
</div>
</section>
<section id="max-iter">
<h3><code class="docutils literal notranslate"><span class="pre">max_iter</span></code><a class="headerlink" href="#max-iter" title="Link to this heading">¶</a></h3>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Do not set this unless you know what you are doing.</p>
</div>
<p>Sets the maximum number of iterations performed by the iterative solver.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasis</span> <span class="o">=</span> <span class="n">mit</span><span class="o">.</span><span class="n">apply_correction</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;iterative&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="tol">
<h3><code class="docutils literal notranslate"><span class="pre">tol</span></code><a class="headerlink" href="#tol" title="Link to this heading">¶</a></h3>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Do not set this unless you know what you are doing.</p>
</div>
<p>Sets the tolerance of the iterative solver.  Might need adjustments to <code class="docutils literal notranslate"><span class="pre">max_iter</span></code> if value
is set too low.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasis</span> <span class="o">=</span> <span class="n">mit</span><span class="o">.</span><span class="n">apply_correction</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;iterative&#39;</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        <div class="related-pages">
          <a class="next-page" href="tutorials/01_M3_ex1.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">M3 paper example</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="balanced.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Balanced calibrations</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021, Mthree Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 2024/09/24</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Advanced usage</a><ul>
<li><a class="reference internal" href="#options-for-m3mitigation-class">Options for M3Mitigation class</a><ul>
<li><a class="reference internal" href="#iter-threshold"><code class="docutils literal notranslate"><span class="pre">iter_threshold</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#options-for-calibration">Options for calibration</a><ul>
<li><a class="reference internal" href="#shots"><code class="docutils literal notranslate"><span class="pre">shots</span></code></a></li>
<li><a class="reference internal" href="#method"><code class="docutils literal notranslate"><span class="pre">method</span></code></a></li>
<li><a class="reference internal" href="#rep-delay"><code class="docutils literal notranslate"><span class="pre">rep_delay</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#initial-reset"><code class="docutils literal notranslate"><span class="pre">initial_reset</span></code></a></li>
<li><a class="reference internal" href="#options-when-applying-corrections">Options when applying corrections</a><ul>
<li><a class="reference internal" href="#id1"><code class="docutils literal notranslate"><span class="pre">method</span></code></a></li>
<li><a class="reference internal" href="#distance"><code class="docutils literal notranslate"><span class="pre">distance</span></code></a></li>
<li><a class="reference internal" href="#details"><code class="docutils literal notranslate"><span class="pre">details</span></code></a></li>
<li><a class="reference internal" href="#max-iter"><code class="docutils literal notranslate"><span class="pre">max_iter</span></code></a></li>
<li><a class="reference internal" href="#tol"><code class="docutils literal notranslate"><span class="pre">tol</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/jquery.js?v=5d32c60e"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="_static/documentation_options.js?v=dfec817d"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/qiskit-sphinx-theme.js?v=4d77b8ca"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>